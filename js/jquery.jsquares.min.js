(function($){$.fn.jsquares=function(options){var main=this,image_counter=0,dropin_int=0,defaults={js_image:'.js-image',js_caption:'.js-small-caption',js_caption_overlay_spacing:12,js_caption_width:400,js_caption_height:130,js_fade_to:.3,js_fade_start:1,js_fade_speed:'fast',js_shuffle_in:true,js_shuffle_in_speed:130,js_fade_on_hover:true,js_caption_slide_down:true,js_caption_slidedown_speed:'fast',_fade_selectors_on_hover:'img, .js-small-caption span',_overlay_selector_class:'js-caption-overlay'},options=$.extend(defaults,options),$js_image=$(options.js_image,main),$js_image_children=$js_image.find(options._fade_selectors_on_hover),window_width=$(window).width();$(window).resize(function(){window_width=$(window).width();});function revealBinds(e,i,evt){caption(i);fadeInOutImage('in',options.js_fade_to,i);}
function fadeInOutImage(in_out,opacity_val,i){var chain=(in_out=='in')?$js_image.not(':eq('+i+')').find(options._fade_selectors_on_hover):$js_image_children;(options.js_fade_on_hover)?$(chain).fadeTo(options.js_fade_speed,opacity_val):$(chain).css('opacity',opacity_val);}
function caption(index){$('.'+options._overlay_selector_class).remove();var $current_image=$(options.js_image+':eq('+index+')',main),overlay_sett=getCaptionSettings($current_image),contents=$current_image.find('.js-overlay-caption-content').html()||'',caption_options=(options.js_caption_slide_down)?{display:'none'}:{};if(contents){var conts=contents,img=$current_image.find('img'),a=img.parent().attr('href')||'',wrap_a_start=(a!='')?'<a href="'+a+'">':'',wrap_a_end=(a!='')?'</a>':'';contents=wrap_a_start+'<img src="'+img.attr('src')+'" class="js-overlay-image" />'+wrap_a_end;contents+='<div class="js-overlay-html">'+conts+'</div><div style="clear:both"></div>';}
var caption_options=$.extend({top:overlay_sett.y,left:overlay_sett.x,width:overlay_sett.width,height:overlay_sett.height},caption_options);$('<div id="js-overlay-id-'+index+'">'+contents+'</div>').css(caption_options).addClass(options._overlay_selector_class).appendTo('body').bind('mouseleave',function(){fadeInOutImage('out',options.js_fade_start)
$('#js-overlay-id-'+index).remove();});if(options.js_caption_slide_down){$('#js-overlay-id-'+index).slideDown(options.js_caption_slidedown_speed)}}
function getCaptionSettings(image){var loc=elementLocation($(image));var loc_x=loc.x-options.js_caption_overlay_spacing;var loc_y=loc.y-options.js_caption_overlay_spacing;var img_height=options.js_caption_height+(options.js_caption_overlay_spacing*2);var img_width=options.js_caption_width+(options.js_caption_overlay_spacing*2);var check_window_width=loc_x+img_width+(options.js_caption_overlay_spacing*2);if(check_window_width>=window_width){var hard_img_width=$(image).outerWidth();loc_x=loc_x-(options.js_caption_width+(options.js_caption_overlay_spacing*2))+hard_img_width;}
return{x:loc_x,y:loc_y,width:img_width,height:img_height};}
function setImageTimeoutSlideDown(images){var images=shuffle(images);dropin_int=setInterval(function(){if(image_counter==images.length){clearInterval(dropin_int);return false;}
var $img=$(options.js_image+':eq('+images[image_counter]+')',main)
var img_height=$img.height();$img.fadeIn(options.js_fade_speed);image_counter++},options.js_shuffle_in_speed);}
function elementLocation(obj){var curleft=0;var curtop=0;do{curleft+=obj.attr('offsetLeft');curtop+=obj.attr('offsetTop');obj=obj.offsetParent();}while(obj.attr('tagName')!='BODY');return{x:curleft,y:curtop};}
function shuffle(v){for(var j,x,i=v.length;i;j=parseInt(Math.random()*i),x=v[--i],v[i]=v[j],v[j]=x);return v;};return this.each(function(){var images=[];$js_image.each(function(i){$(this).hide();images.push(i);});(options.js_shuffle_in)?setImageTimeoutSlideDown(images):$js_image.show();$js_image.each(function(i){$(this).hoverIntent(function(evt){revealBinds(this,i,evt);},function(evt){});});});};$.fn.jSquares=$.fn.jsquares;})(jQuery);if(typeof $.fn.hoverIntent!='function'){(function($){$.fn.hoverIntent=function(f,g){var cfg={sensitivity:7,interval:100,timeout:0};cfg=$.extend(cfg,g?{over:f,out:g}:f);var cX,cY,pX,pY;var track=function(ev){cX=ev.pageX;cY=ev.pageY;};var compare=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);if((Math.abs(pX-cX)+Math.abs(pY-cY))<cfg.sensitivity){$(ob).unbind("mousemove",track);ob.hoverIntent_s=1;return cfg.over.apply(ob,[ev]);}else{pX=cX;pY=cY;ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}};var delay=function(ev,ob){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);ob.hoverIntent_s=0;return cfg.out.apply(ob,[ev]);};var handleHover=function(e){var p=(e.type=="mouseover"?e.fromElement:e.toElement)||e.relatedTarget;while(p&&p!=this){try{p=p.parentNode;}catch(e){p=this;}}if(p==this){return false;}var ev=jQuery.extend({},e);var ob=this;if(ob.hoverIntent_t){ob.hoverIntent_t=clearTimeout(ob.hoverIntent_t);}if(e.type=="mouseover"){pX=ev.pageX;pY=ev.pageY;$(ob).bind("mousemove",track);if(ob.hoverIntent_s!=1){ob.hoverIntent_t=setTimeout(function(){compare(ev,ob);},cfg.interval);}}else{$(ob).unbind("mousemove",track);if(ob.hoverIntent_s==1){ob.hoverIntent_t=setTimeout(function(){delay(ev,ob);},cfg.timeout);}}};return this.mouseover(handleHover).mouseout(handleHover);};})(jQuery);}